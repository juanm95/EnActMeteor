<template name="Page_Template">

  <body>
    <script>
      function showTagList(id) {
        document.getElementById("tagOptionsDropdown" + id).classList.toggle("show");
      }

      // Close the dropdown menu if the user clicks outside of it
      window.onclick = function(event) {
        if (!event.target.matches('.dropbtn')) {

          var dropdowns = document.getElementsByClassName("dropdown-content");
          var i;
          for (i = 0; i < dropdowns.length; i++) {
            var openDropdown = dropdowns[i];
            if (openDropdown.classList.contains('show')) {
              openDropdown.classList.remove('show');
            }
          }
        }
      }

      function addTagToIssue(tag, id) {
        Issues.update(
          {_id: id}, 
          {$addToSet: {tags: tag}}
        )
      }

      function deleteTag(tag, id){
        Issues.update(
          {_id: id}, 
          { $pull: {tags: tag} }
        )
      }
    </script>
    <div class="container">
      <header>
        <h1>EnAct</h1>
        <div class="login">{{> loginButtons}}</div>
        <h2>Open Issues: {{openIssuesCount}}</h2>
        
        <div class="tag-list">
          {{#each alltags}}
            <label class="checkBoxClass">
              <input type="checkbox" name={{this}}> {{this}}
            </label>
          {{/each}}
       </div>

        <div id="status">
        </div>
      </header>

      <!-- In order to test the saving of innerHTML and then displaying that, first uncomment the old code to gather the innerHTML, then once the innerHTML has been added to the database (check it in meteor mongo), come back here, and comment it out. -->
      <div class="all-posts-container">
        {{#each posts}}
        <div class="fb-post-container">
          <div class="fb-post">
            <iframe name="f4797221a7347" width="500px" height="1000px" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" title="fb:post Facebook Social Plugin" src="https://www.facebook.com/v2.8/plugins/post.php?app_id=1293600994030280&amp;channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter%2Fr%2F_IDqWBiKXtV.js%3Fversion%3D42%23cb%3Df9984fc4ef0228%26domain%3Dlocalhost%26origin%3Dhttp%253A%252F%252Flocalhost%253A3000%252Ff36f79e75ea0b68%26relation%3Dparent.parent&amp;container_width=60&amp;height=1000&amp;href={{url}};locale=en_US&amp;sdk=joey&amp;show_text=true&amp;width=500" style="border: none; visibility: visible; width: 350px; height: 480px;" class=""></iframe>
          </div>

            <div class="extra-post-info">
              <div class="comments">
                {{#each comments}}
                <li class="comment">{{this}}</li>
                {{/each}}
              </div>
              {{#if currentUserIsAdmin}}
                <div class="issue-tag-list">
                  {{#each tags}}
                    <button type="button" onclick ="deleteTag('{{this}}','{{../_id}}')" class="issue-tag">{{this}}</button>
                  {{/each}}
                  <button onclick="showTagList('{{_id}}')" class="dropbtn">+</button>
                  <div id="tagOptionsDropdown{{_id}}" class="dropdown-content">
                    {{#each alltags}}
                      <li><button onclick="addTagToIssue('{{this}}', '{{../_id}}')">{{this}}</button></li>
                    {{/each}}
                  </div>
                </div>
              {{/if}}
            </div>
          </div>
        {{/each}}
      </div>
      <button id="requestPages">request more content</button>
    </div>
  </body>
</template>